<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:a="http://java.sun.com/jsf/composite/application"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">

        <div class="ui-g">
            <div class="ui-g-9" style="margin-left: 12%;margin-top: 3%">
                <span class="tab" />

                <div class="card" style="border: solid 1px; border-color: #C9D3DD"> 
                    <h3 class="BigTopic" style="padding: 5% 0% 0% 4%" ><i class="fa fa-file-text-o Fs40" style="color: #848484"/> #{l.Relatorio_De_Contas}</h3>
                    <div class="EmptyBox40"/>
                    <div style="padding: 0% 8% 4% 8%">


                        <p:panelGrid columns="2" style="width: 50%" layout="grid" columnClasses="ui-g-12 ui-md-6 ui-lg-2,ui-g-12 ui-md-6 ui-lg-10 ui-fluid" styleClass="ui-panelgrid-blank form-group form-elements">
                            <p:outputLabel value="#{l.Filtrar_Por}:"/>
                            <p:selectOneMenu id="camposParaFiltrar" value="#{relatorioDeContasView.campoSelecionadoString}">
                                <p:ajax listener="#{relatorioDeContasView.filterField}" update="@form" />
                                <f:selectItem itemLabel="#{l.Selecione}" />
                                <f:selectItems value="#{relatorioDeContasView.campos.list}" var="fieldModel" itemValue="#{fieldModel.header}" itemLabel="#{fieldModel.header}" />
                            </p:selectOneMenu>

                            <p:outputLabel value="#{l.Tipo_de_Busca}:"/>
                            <p:selectOneMenu id="tiposDeBusca" value="#{relatorioDeContasView.tipoDeBuscaSelecionada}">
                                <f:selectItems value="#{relatorioDeContasView.tiposDeBusca}" var="tipoDeBusca" itemValue="#{tipoDeBusca}" itemLabel="#{tipoDeBusca.nome}" />
                            </p:selectOneMenu>

                            <p:outputLabel value="#{l.Consulta}:"/>
                            <p:chips id="chipsFilter" value="#{relatorioDeContasView.consulta}" 
                                     rendered="#{!relatorioDeContasView.date}" />
                            <p:calendar id="dateFilter" pattern="dd/MM/yyyy" value="#{relatorioDeContasView.consultaDate}" size="9" navigator="true" pages="3"
                                        rendered="#{relatorioDeContasView.date}" maskAutoClear="true" />

                        </p:panelGrid>

                        <p:panelGrid columns="2" style="width: 50%" layout="grid" columnClasses="ui-g-12 ui-md-6 ui-lg-2,ui-g-12 ui-md-6 ui-lg-10" styleClass="ui-panelgrid-blank form-group form-elements">
                            <p:spacer/>
                            <p:commandButton value="#{l.Pesquisar}" action="#{relatorioDeContasView.pesquisar}" update=":conteudo" />
                        </p:panelGrid>

                        <p:panelGrid columns="2" style="width: 50%" layout="grid" columnClasses="ui-g-12 ui-md-6 ui-lg-2,ui-g-12 ui-md-6 ui-lg-10 ui-fluid" styleClass="ui-panelgrid-blank form-group form-elements">
                            <p:spacer/>
                            <p:column>
                                <c:forEach var="filterModel" items="#{relatorioDeContasView.filtros}" >

                                    <ul class="ui-chips-container">
                                        <p:outputLabel value="#{filterModel.field.header} - #{filterModel.typeSearch.nome}  " /> 
                                        <li class="ui-chips-token ui-state-active ui-corner-all" style="margin-top: -1px">
                                            <span class="ui-chips-token-label">#{filterModel.filterDate ne null ? filterModel.filterDateFormat : filterModel.filters}</span>
                                            <p:commandLink action="#{relatorioDeContasView.delFilter(filterModel)}" update=":conteudo">
                                                <i class="ui-chips-token-icon ui-icon ui-icon-close" style="color: white;"/>
                                            </p:commandLink>
                                        </li>
                                    </ul>

                                </c:forEach>
                            </p:column>
                        </p:panelGrid>

                        <p:dialog widgetVar="exibirCampos" width="900" height="800">

                            <h:panelGrid columns="3" style="height: 95%">

                                <p:dataTable id="campos" widgetVar="camposTable" var="m" value="#{relatorioDeContasView.camposDisponiveis}" selectionMode="multiple" emptyMessage="#{l.Nao_Ha_Registros}" 
                                             rowKey="#{m.id}" reflow="true" style="border: none" scrollable="true" scrollHeight="600" selection="#{relatorioDeContasView.modelDisponivelSelecionado}">

                                    <f:facet name="header" >
                                        <div align="right">
                                            <h:outputText value="#{l.Campos_Disponiveis}: " />
                                            <p:inputText id="globalFilter" onkeyup="PF('camposTable').filter()" style="margin-right: 5px" placeholder="#{l.Pesquisar}"/>
                                        </div>
                                    </f:facet>

                                    <p:column headerText="#{l.Nome}" sortBy="#{m.object.header}" filterBy="#{m.object.header}" footerText="#{l.Nome}" filterMatchMode="contains">
                                        <h:outputText value="#{m.object.header}"/>
                                    </p:column>

                                </p:dataTable>

                                <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group form-elements">

                                    <p:commandButton icon="fa fa-angle-right" action="#{relatorioDeContasView.adicionarParaCampoExibido()}" update=":conteudo:campos :conteudo:camposExibidos" onsuccess="PF('camposTable').filter(), PF('camposExibidosTable').filter()" />
                                    <p:commandButton icon="fa fa-angle-double-right" action="#{relatorioDeContasView.adicionarTodosParaCampoExibido()}" update=":conteudo:campos :conteudo:camposExibidos" onsuccess="PF('camposTable').filter(), PF('camposExibidosTable').filter()" />
                                    <p:commandButton icon="fa fa-angle-left" action="#{relatorioDeContasView.excluirDeCampoExibido()}" update=":conteudo:campos :conteudo:camposExibidos" onsuccess="PF('camposTable').filter(), PF('camposExibidosTable').filter()"/>
                                    <p:commandButton icon="fa fa-angle-double-left" action="#{relatorioDeContasView.excluirTodosDeCampoExibido()}" update=":conteudo:campos :conteudo:camposExibidos" onsuccess="PF('camposTable').filter(), PF('camposExibidosTable').filter()" />

                                </p:panelGrid>

                                <p:dataTable id="camposExibidos" widgetVar="camposExibidosTable" var="m" value="#{relatorioDeContasView.camposExibidos}" selectionMode="multiple" emptyMessage="#{l.Nao_Ha_Registros}"
                                             rowKey="#{m.id}" reflow="true" style="border: none" scrollable="true" scrollHeight="600" draggableRows="true" editMode="cell" 
                                             editable="true" selection="#{relatorioDeContasView.modelExibidoSelecionado}">

                                    <p:ajax event="rowReorder" listener="#{relatorioDeContasView.onRowReorder}"/>

                                    <f:facet name="header" >
                                        <div align="right">
                                            <h:outputText value="#{l.Campos_Exibidos}: " />
                                            <p:inputText id="globalFilter" onkeyup="PF('camposExibidosTable').filter()" style="margin-right: 5px" placeholder="#{l.Pesquisar}"/>
                                        </div>
                                    </f:facet>

                                    <p:column headerText="#{l.Nome}" sortBy="#{m.object.header}" filterBy="#{m.object.header}" footerText="#{l.Nome}" filterMatchMode="contains">
                                        <h:outputText value="#{m.object.header}"/>
                                    </p:column>

                                    <p:column headerText="#{l.Tamanho}" footerText="#{l.Tamanho}" style="text-align: center; width: 60px">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{m.object.size}"/></f:facet>
                                            <f:facet name="input">
                                                <p:spinner value="#{m.object.size}" min="0" style="text-align: center"/>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                </p:dataTable>

                            </h:panelGrid>

                            <p:commandButton value="#{l.Confirmar}" update=":conteudo:cobrancas" process="@parent" onclick="PF('exibirCampos').hide()"/>

                        </p:dialog>


                    </div>
                </div>

                <div class="card" style="border: solid 1px; border-color: #C9D3DD"> 
                    <div class="EmptyBox40"/>

                    <div style="padding: 0% 8% 0% 8%">

                        <p:dataTable id="cobrancas" widgetVar="cobrancasTable" var="cobranca" value="#{relatorioDeContasView.registros}" selectionMode="single" emptyMessage="#{l.Nao_Ha_Registros}"
                                     rowKey="#{cobranca.id}" reflow="true" style="border: none" >

                            <f:facet name="header" >
                                <div align="right">
                                    <h:outputText value="#{l.Pesquisar_por_todos_campos}: " />
                                    <p:inputText id="globalFilter" onkeyup="PF('cobrancasTable').filter()" style="width:150px; margin-right: 5px" placeholder="#{l.Pesquisar}"/>
                                    <p:commandButton icon="fa fa-calculator" value="#{l.Exibir_Campos}" onclick="PF('exibirCampos').show()"/>
                                </div>
                            </f:facet>

                            <p:columns var="coluna" value="#{relatorioDeContasView.camposExibidos.list}" 
                                       filterBy="#{cobranca ne null ? coluna.clazz ne relatorioDeContasView.clazz ? coluna.clazz ne cobranca.class ? !relatorioDeContasView.mapPath.containsKey(coluna.clazz) ? ' ' 
                                                   : coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                   coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                   coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                   cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour] :  
                                                   coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                   coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                   coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                   cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour] : 
                                                   coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                   coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                   coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                   cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour] : ''}"
                                       sortBy="#{coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                 coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                 coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                 cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour]}"
                                       headerText="#{coluna.header}" footerText="#{coluna.header}" style="width: #{coluna.formatSize}" 
                                       >
                                <h:outputText value="#{coluna.clazz ne relatorioDeContasView.clazz ? coluna.clazz ne cobranca.class ? !relatorioDeContasView.mapPath.containsKey(coluna.clazz) ? ' ' 
                                                       : coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                       coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                       coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                       cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour] :  
                                                       coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                       coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                       coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                       cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour] : 
                                                       coluna.propertyTwo eq null ? cobranca[coluna.property] : 
                                                       coluna.propertyThree eq null ? cobranca[coluna.property][coluna.propertyTwo] : 
                                                       coluna.propertyFour eq null ? cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree] : 
                                                       cobranca[coluna.property][coluna.propertyTwo][coluna.propertyThree][coluna.propertyFour]}" />
                            </p:columns>

                        </p:dataTable>


                    </div>
                </div>

            </div>
        </div>


    </ui:define>

</ui:composition>